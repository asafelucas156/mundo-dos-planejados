<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mundo dos Planejados - Sistema Financeiro</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #ececec;
  padding: 20px;
}
.container {
  max-width: 1100px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 10px;
}
h1, h2, h3 {
  color: #222;
}
input, select, button {
  width: 100%;
  padding: 10px;
  margin: 6px 0;
}
button {
  background: #007bff;
  color: #fff;
  border: none;
  cursor: pointer;
  border-radius: 4px;
}
button:hover {
  background: #0056b3;
}
.card {
  background: #f8f8f8;
  padding: 15px;
  margin-top: 15px;
  border-radius: 8px;
}
.resumo {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}
.box {
  flex: 1;
  background: #fff;
  padding: 15px;
  border-radius: 8px;
  text-align: center;
}
.lucro { color: green; font-weight: bold; }
.prejuizo { color: red; font-weight: bold; }
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
th, td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: center;
}
th {
  background: #007bff;
  color: #fff;
}
.excluir {
  background: #dc3545;
}
.excluir:hover {
  background: #b52a37;
}
</style>
</head>

<body>

<!-- ðŸ”’ SENHA -->
<script>
const SENHA_CORRETA = "1234"; // <<< MUDE AQUI
const senha = prompt("Ãrea restrita - Digite a senha:");

if (senha !== SENHA_CORRETA) {
  document.body.innerHTML = "<h2 style='text-align:center;margin-top:100px'>Acesso negado</h2>";
  throw new Error("Bloqueado");
}
</script>

<div class="container">
<h1>Mundo dos Planejados</h1>
<h2>Controle Financeiro Detalhado</h2>

<!-- âœï¸ CADASTRO -->
<div class="card">
<h3>Novo Projeto</h3>

<input id="cliente" placeholder="Nome do cliente">

<select id="mes">
  <option value="">MÃªs</option>
  <option value="01">Janeiro</option>
  <option value="02">Fevereiro</option>
  <option value="03">MarÃ§o</option>
  <option value="04">Abril</option>
  <option value="05">Maio</option>
  <option value="06">Junho</option>
  <option value="07">Julho</option>
  <option value="08">Agosto</option>
  <option value="09">Setembro</option>
  <option value="10">Outubro</option>
  <option value="11">Novembro</option>
  <option value="12">Dezembro</option>
</select>

<input id="ano" type="number" value="2026" placeholder="Ano">
<input id="venda" type="number" placeholder="Valor da venda">
<input id="material" type="number" placeholder="Custo material">
<input id="maoObra" type="number" placeholder="Custo mÃ£o de obra">
<input id="outros" type="number" placeholder="Outros custos">

<button onclick="adicionar()">Adicionar Projeto</button>
</div>

<!-- ðŸ“Š RESUMO -->
<div class="card resumo">
  <div class="box">
    <h3>Faturamento</h3>
    <p>R$ <span id="fat">0</span></p>
  </div>
  <div class="box">
    <h3>Custos</h3>
    <p>R$ <span id="custos">0</span></p>
  </div>
  <div class="box">
    <h3>Lucro</h3>
    <p id="lucro" class="lucro">R$ 0</p>
  </div>
</div>

<!-- ðŸ“‹ LISTA -->
<div class="card">
<h3>Projetos Cadastrados</h3>
<table>
<thead>
<tr>
<th>Cliente</th>
<th>MÃªs/Ano</th>
<th>Venda</th>
<th>Material</th>
<th>MÃ£o de obra</th>
<th>Outros</th>
<th>Lucro</th>
<th>AÃ§Ã£o</th>
</tr>
</thead>
<tbody id="lista"></tbody>
</table>
</div>

<!-- ðŸ“ˆ GRÃFICOS -->
<div class="card">
<h3>Faturamento por MÃªs</h3>
<canvas id="grafFat"></canvas>
</div>

<div class="card">
<h3>Lucro por MÃªs</h3>
<canvas id="grafLuc"></canvas>
</div>

</div>

<script>
let projetos = JSON.parse(localStorage.getItem("projetosDetalhados")) || [];
let gFat, gLuc;

function adicionar() {
  const p = {
    cliente: cliente.value,
    mes: mes.value,
    ano: ano.value,
    venda: +venda.value,
    material: +material.value,
    maoObra: +maoObra.value,
    outros: +outros.value
  };

  if (!p.cliente || !p.mes || !p.venda) {
    alert("Preencha cliente, mÃªs e venda");
    return;
  }

  projetos.push(p);
  salvar();
}

function excluir(i) {
  projetos.splice(i, 1);
  salvar();
}

function salvar() {
  localStorage.setItem("projetosDetalhados", JSON.stringify(projetos));
  atualizar();
}

function atualizar() {
  lista.innerHTML = "";
  let dados = {}, fatTotal = 0, custoTotal = 0;

  projetos.forEach((p, i) => {
    const custo = p.material + p.maoObra + p.outros;
    const lucro = p.venda - custo;

    fatTotal += p.venda;
    custoTotal += custo;

    const chave = `${p.mes}/${p.ano}`;
    if (!dados[chave]) dados[chave] = { v: 0, l: 0 };
    dados[chave].v += p.venda;
    dados[chave].l += lucro;

    lista.innerHTML += `
      <tr>
        <td>${p.cliente}</td>
        <td>${p.mes}/${p.ano}</td>
        <td>R$ ${p.venda.toFixed(2)}</td>
        <td>R$ ${p.material.toFixed(2)}</td>
        <td>R$ ${p.maoObra.toFixed(2)}</td>
        <td>R$ ${p.outros.toFixed(2)}</td>
        <td class="${lucro>=0?'lucro':'prejuizo'}">R$ ${lucro.toFixed(2)}</td>
        <td><button class="excluir" onclick="excluir(${i})">Excluir</button></td>
      </tr>`;
  });

  fat.innerText = fatTotal.toFixed(2);
  custos.innerText = custoTotal.toFixed(2);
  lucro.innerText = "R$ " + (fatTotal - custoTotal).toFixed(2);

  const labels = Object.keys(dados);
  const fatMes = labels.map(l => dados[l].v);
  const lucMes = labels.map(l => dados[l].l);

  if (gFat) gFat.destroy();
  if (gLuc) gLuc.destroy();

  gFat = new Chart(grafFat, { type: "bar", data: { labels, datasets: [{ label: "Faturamento", data: fatMes }] }});
  gLuc = new Chart(grafLuc, { type: "line", data: { labels, datasets: [{ label: "Lucro", data: lucMes }] }});
}

atualizar();
</script>

</body>
</html>
