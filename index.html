<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mundo dos Planejados - Controle Completo</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  padding: 20px;
}
.container {
  max-width: 1000px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 8px;
}
h1, h2, h3 {
  color: #333;
}
input, select, button {
  width: 100%;
  padding: 10px;
  margin: 5px 0;
}
button {
  background: #007bff;
  color: white;
  border: none;
  cursor: pointer;
}
button:hover {
  background: #0056b3;
}
.card {
  background: #f9f9f9;
  padding: 15px;
  margin-top: 15px;
  border-radius: 5px;
}
.resumo {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
}
.box {
  background: #fff;
  padding: 15px;
  border-radius: 5px;
  width: 30%;
  text-align: center;
}
.lucro { color: green; font-weight: bold; }
.prejuizo { color: red; font-weight: bold; }
canvas { max-width: 100%; }
</style>
</head>

<body>

<!-- ðŸ”’ BLOQUEIO POR SENHA -->
<script>
const SENHA_CORRETA = "1234"; // <<< MUDE AQUI

const senha = prompt("Ãrea restrita - Digite a senha:");

if (senha !== SENHA_CORRETA) {
  document.body.innerHTML = "<h2 style='text-align:center;margin-top:100px'>Acesso negado</h2>";
  throw new Error("Bloqueado");
}
</script>

<div class="container">
<h1>Mundo dos Planejados</h1>
<h2>Controle Financeiro Completo</h2>

<!-- âœï¸ ANOTAÃ‡ÃƒO -->
<div class="card">
<h3>Novo Projeto</h3>

<input type="text" id="cliente" placeholder="Nome do cliente">

<select id="mes">
  <option value="">MÃªs</option>
  <option value="01">Janeiro</option>
  <option value="02">Fevereiro</option>
  <option value="03">MarÃ§o</option>
  <option value="04">Abril</option>
  <option value="05">Maio</option>
  <option value="06">Junho</option>
  <option value="07">Julho</option>
  <option value="08">Agosto</option>
  <option value="09">Setembro</option>
  <option value="10">Outubro</option>
  <option value="11">Novembro</option>
  <option value="12">Dezembro</option>
</select>

<input type="number" id="ano" placeholder="Ano" value="2026">
<input type="number" id="venda" placeholder="Valor da venda (R$)">
<input type="number" id="material" placeholder="Custo material (R$)">
<input type="number" id="maoObra" placeholder="Custo mÃ£o de obra (R$)">
<input type="number" id="outros" placeholder="Outros custos (R$)">

<button onclick="adicionarProjeto()">Adicionar Projeto</button>
</div>

<!-- ðŸ“Š RESUMO -->
<div class="card resumo">
  <div class="box">
    <h3>Faturamento</h3>
    <p>R$ <span id="fatTotal">0</span></p>
  </div>
  <div class="box">
    <h3>Custos</h3>
    <p>R$ <span id="custosTotal">0</span></p>
  </div>
  <div class="box">
    <h3>Lucro</h3>
    <p id="lucroTotal" class="lucro">R$ 0</p>
  </div>
</div>

<!-- ðŸ“ˆ GRÃFICOS -->
<div class="card">
  <h3>Faturamento por MÃªs</h3>
  <canvas id="graficoFaturamento"></canvas>
</div>

<div class="card">
  <h3>Lucro por MÃªs</h3>
  <canvas id="graficoLucro"></canvas>
</div>
</div>

<script>
let projetos = JSON.parse(localStorage.getItem("projetosMensais")) || [];

let graficoFat, graficoLuc;

function adicionarProjeto() {
  const cliente = clienteEl.value;
  const mes = mesEl.value;
  const ano = anoEl.value;
  const venda = Number(vendaEl.value);
  const material = Number(materialEl.value);
  const maoObra = Number(maoObraEl.value);
  const outros = Number(outrosEl.value);

  if (!cliente || !mes || !ano || !venda) {
    alert("Preencha cliente, mÃªs, ano e venda");
    return;
  }

  projetos.push({ cliente, mes, ano, venda, material, maoObra, outros });
  localStorage.setItem("projetosMensais", JSON.stringify(projetos));

  limpar();
  atualizarDashboard();
}

function limpar() {
  clienteEl.value = vendaEl.value = materialEl.value = maoObraEl.value = outrosEl.value = "";
}

function atualizarDashboard() {
  let dados = {};
  let totalFat = 0;
  let totalCustos = 0;

  projetos.forEach(p => {
    const chave = `${p.mes}/${p.ano}`;
    if (!dados[chave]) dados[chave] = { vendas: 0, custos: 0 };
    const custo = p.material + p.maoObra + p.outros;
    dados[chave].vendas += p.venda;
    dados[chave].custos += custo;
    totalFat += p.venda;
    totalCustos += custo;
  });

  const labels = Object.keys(dados);
  const faturamento = labels.map(l => dados[l].vendas);
  const lucro = labels.map(l => dados[l].vendas - dados[l].custos);

  fatTotal.innerText = totalFat.toFixed(2);
  custosTotal.innerText = totalCustos.toFixed(2);
  lucroTotal.innerText = "R$ " + (totalFat - totalCustos).toFixed(2);
  lucroTotal.className = totalFat - totalCustos >= 0 ? "lucro" : "prejuizo";

  if (graficoFat) graficoFat.destroy();
  if (graficoLuc) graficoLuc.destroy();

  graficoFat = new Chart(graficoFaturamento, {
    type: "bar",
    data: { labels, datasets: [{ label: "Faturamento", data: faturamento }] }
  });

  graficoLuc = new Chart(graficoLucro, {
    type: "line",
    data: { labels, datasets: [{ label: "Lucro", data: lucro }] }
  });
}

const clienteEl = document.getElementById("cliente");
const mesEl = document.getElementById("mes");
const anoEl = document.getElementById("ano");
const vendaEl = document.getElementById("venda");
const materialEl = document.getElementById("material");
const maoObraEl = document.getElementById("maoObra");
const outrosEl = document.getElementById("outros");

atualizarDashboard();
</script>

</body>
</html>
